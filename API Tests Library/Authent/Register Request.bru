meta {
  name: Register Request
  type: http
  seq: 1
}

post {
  url: {{host}}/auth/register
  body: json
  auth: none
}

headers {
  Content-Type: application/json
}

body:json {
  {
    "username": "MathieuGr",
    "password": "123mtdPSSCHX@",
    "email": "mathgr@gmail.com"
  }
}

script:post-response {
  let data = res?.body;
  
  if (typeof data === "string") {
    try { data = JSON.parse(data); }
    catch (e) {
      console.log("❌ Body non-JSON, parse impossible :", e);
    }
  }
  
  if (data?.token) {
    bru.setVar("token", data.token);
    console.log("Token sauvegardé :", data.token);
  } else {
    console.log("Aucun token trouvé. Statut:", res?.status, "Body:", res?.body);
  }
}

settings {
  encodeUrl: true
}
